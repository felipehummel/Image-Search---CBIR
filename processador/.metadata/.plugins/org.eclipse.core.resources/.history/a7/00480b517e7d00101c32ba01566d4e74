import java.util.concurrent.Callable;


public class ShardProcessor implements Callable<ImageScore[]>{
	private final int[] query_feature_array;
	public ShardProcessor(int[] _query_feature_array) {
		query_feature_array = _query_feature_array;
	}
	@Override
	public ImageScore[] call() throws Exception {
		int[] keys = images.keys;
		int id;
		int[] feature_array;
		int[] query_feature_array = images.get(query_image);
		float score;
		HitQueue pq = new HitQueue(10, true);
        ImageScore pqTop = pq.top();
		for (int i = 0; i < keys.length; i++) {
			id = keys[i];
			feature_array = images.get(id);
			score = similarity.calculateSimilarity(feature_array, query_feature_array);
			if (score > pqTop.score) {
        		pqTop.id = id;
                pqTop.score = score;
                pqTop = pq.updateTop();
        	}
		}
		ImageScore[] results = getResults(pq);
		return results;
	}

}
